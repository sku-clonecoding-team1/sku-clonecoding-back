<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Load JSON Movie Data</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
    <script src="https://cdn.iamport.kr/vl/iamport.js"></script> <!-- 아임포트 스크립트 -->
</head>
<body>
<h1>Load JSON Movie Data into MySQL</h1>
<a th:href="@{/index}">Load Data</a>

<form id="movieScheduleForm" onsubmit="addMovieSchedule(event)">
    <label for="movieId">영화 ID:</label>
    <input type="number" id="movieId" name="movieId" required><br>

    <label for="cinemaId">영화관 ID:</label>
    <input type="number" id="cinemaId" name="cinemaId" required><br>

    <label for="theaterId">영화관의 관:</label>
    <select id="theaterId" name="theaterId" required>
        <option value="">관 선택</option>
        <option value="1">1번</option>
        <option value="2">2번</option>
        <option value="3">3번</option>
        <option value="4">4번</option>
        <option value="5">5번</option>
        <option value="6">6번</option>
    </select><br>

    <label for="scheduleDate">날짜 및 시간:</label>
    <input type="datetime-local" id="scheduleDate" name="scheduleDate" required><br>

    <button type="submit">영화 일정 추가</button>
</form>

<!-- 결제 정보 입력 섹션 -->
<h1>1달러샵에 오신걸을 환영합니다. ^^</h1>
<a href="/order">주문페이지로 이동</a>

<script>
    function addMovieSchedule(event) {
        event.preventDefault(); // 기본 폼 제출 방지

        const form = document.getElementById('movieScheduleForm');
        const formData = new FormData(form);

        // 폼 데이터를 MovieScheduleDTO 형식에 맞게 변환
        const data = {
            movieId: parseInt(formData.get('movieId')),  // 영화 ID
            cinemaId: parseInt(formData.get('cinemaId')),  // 영화관 ID
            theaterId: parseInt(formData.get('theaterId')),  // 영화관의 관 ID
            scheduleDate: new Date(formData.get('scheduleDate')) // 날짜 및 시간
        };

        // AJAX 요청으로 서버에 데이터 전송
        fetch('/addMovieSchedule', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
            .then(response => response.json())
            .then(result => {
                alert('영화 일정이 추가되었습니다!');
                console.log(result);
            })
            .catch(error => {
                console.error('Error:', error);
                alert('영화 일정 추가에 실패했습니다.');
            });
    }


</script>

</body>
</html>
