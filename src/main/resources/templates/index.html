<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <link rel="stylesheet" type="text/css" href="/style.css">
    <title>Load JSON Movie Data</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
    <script src="https://cdn.iamport.kr/vl/iamport.js"></script> <!-- 아임포트 스크립트 -->
</head>
<body>
<h1>Load JSON Movie Data into MySQL</h1>
<a th:href="@{/index}">Load Data</a>

<form id="movieScheduleForm" onsubmit="addMovieSchedule(event)">
    <label for="movieId">영화 ID:</label>
    <input type="number" id="movieId" name="movieId" required><br>

    <label for="cinemaId">영화관 ID:</label>
    <input type="number" id="cinemaId" name="cinemaId" required><br>

    <label for="theaterId">영화관의 관:</label>
    <select id="theaterId" name="theaterId" required>
        <option value="">관 선택</option>
        <option value="1">1번</option>
        <option value="2">2번</option>
        <option value="3">3번</option>
        <option value="4">4번</option>
        <option value="5">5번</option>
        <option value="6">6번</option>
    </select><br>

    <label for="scheduleDate">날짜 및 시간:</label>
    <input type="datetime-local" id="scheduleDate" name="scheduleDate" required><br>

    <button type="submit">영화 일정 추가</button>
</form>

<!-- 예약 정보 테이블 -->
<h2>예약 정보</h2>
<table id="reservationTable" border="1">
    <thead>
    <tr>
        <th>영화 ID</th>
        <th>영화관 ID</th>
        <th>관 ID</th>
        <th>날짜 및 시간</th>
        <th>좌석 상태</th>
    </tr>
    </thead>
    <tbody>
    <!-- 예약 정보가 여기에 추가됩니다 -->
    </tbody>
</table>

<!-- 영화 일정 가져오기 버튼 -->
<button onclick="getMovieSchedule()">영화 일정 가져오기</button>

<script>
    function addMovieSchedule(event) {
        event.preventDefault(); // 기본 폼 제출 방지

        const form = document.getElementById('movieScheduleForm');
        const formData = new FormData(form);

        // 폼 데이터를 MovieScheduleDTO 형식에 맞게 변환
        const data = {
            movieId: parseInt(formData.get('movieId')),  // 영화 ID
            cinemaId: parseInt(formData.get('cinemaId')),  // 영화관 ID
            theaterId: parseInt(formData.get('theaterId')),  // 영화관의 관 ID
            scheduleDate: new Date(formData.get('scheduleDate')) // 날짜 및 시간
        };

        // AJAX 요청으로 서버에 데이터 전송
        fetch('/addMovieSchedule', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
            .then(response => response.json())
            .then(result => {
                alert('영화 일정이 추가되었습니다!');
                console.log(result);
            })
            .catch(error => {
                console.error('Error:', error);
                alert('영화 일정 추가에 실패했습니다.');
            });
    }

    function getMovieSchedule() {
        fetch('/getMovieScheduleAll', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            }
        })
            .then(response => response.json())
            .then(schedules => {
                const tbody = document.getElementById('reservationTable').querySelector('tbody');
                tbody.innerHTML = ''; // 기존 내용을 비움

                schedules.forEach(schedule => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${schedule.movieId}</td>
                        <td>${schedule.cinemaName}</td>
                        <td>${schedule.theaterId}</td>
                        <td>${new Date(schedule.scheduleDate).toLocaleString()}</td>
                        <td>${createSeatingMatrix()}</td>
                    `;
                    tbody.appendChild(row);
                });
            })
            .catch(error => {
                console.error('Error fetching movie schedules:', error);
            });
    }

    function createSeatingMatrix() {
        const rows = 13; // A부터 M까지의 13개 행
        const cols = 16; // 1부터 16까지의 16개 열
        let seatingHTML = ''; // 좌석 HTML 문자열 초기화

        for (let i = 0; i < rows; i++) {
            for (let j = 0; j < cols; j++) {
                const seatLabel = String.fromCharCode(65 + i) + (j + 1); // A1, B1, C1 형식
                seatingHTML += `<button style="background-color: green;" onclick="alert('${seatLabel} 좌석 클릭됨!')">${seatLabel}</button>`;
            }
            seatingHTML += '<br>'; // 각 행 끝에 줄 바꿈 추가
        }

        return seatingHTML; // 생성된 HTML 반환
    }
</script>

</body>
</html>
